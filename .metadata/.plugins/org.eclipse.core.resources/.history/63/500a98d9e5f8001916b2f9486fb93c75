package steps;

import java.util.List;
import java.util.Map;

import org.json.JSONArray;
import org.json.JSONObject;
import org.testng.Assert;

import com.fasterxml.jackson.core.JsonParser;
import com.fasterxml.jackson.databind.JsonNode;
import com.fasterxml.jackson.databind.ObjectMapper;

import io.cucumber.java.en.Given;
import io.cucumber.java.en.Then;
import io.restassured.RestAssured;
import io.restassured.builder.RequestSpecBuilder;
import io.restassured.path.json.JsonPath;
import io.restassured.response.Response;
import io.restassured.response.ResponseOptions;
import io.restassured.specification.RequestSpecification;
import pojos.JsonBody;
import pojos.ProductList;
import utility.Common;
import utility.RestAssuredHelper;

public class GetProductList  {

	RestAssuredHelper restAssuredExtension = new RestAssuredHelper();	
    ResponseOptions<Response> res;
	Common commonUtility = new Common();
	Map<String,String> uniquePath;
	JsonBody json ;
	
	@Given("I perform get operation {string} to get the list of product")
	public void i_perform_get_operation_to_get_the_list_of_product(String url_pattern) {
		
		res = (ResponseOptions<Response>) restAssuredExtension.GetOps(url_pattern).getBody();
		
	}

	@Then("the product in {int} as the price as {string}")
	public void the_product_is_as_the_price_as(int id, String price) {
		
		Assert.assertTrue(res.getBody().jsonPath().get("[0].id").equals(id));
		Assert.assertTrue(res.getBody().jsonPath().get("[0].price").equals(price));
	  
	}
	
	@Given("I perform post operation {string} to get the list of product")
	public void i_perform_post_operation_to_get_the_list_of_product(String url, io.cucumber.datatable.DataTable dataTable) {
		List<Map<String, String>> list = dataTable.asMaps(String.class, String.class);
	   
	   String name = list.get(0).get("Name");
	  
		
	   String s = "{\n" + 
	   		"    \"id\": 100,\n" + 
	   		"    \"name\": \"Lavender heart--- Manjula added to create\",\n" + 
	   		"    \"price\": 9999999999999999999\n" + 
	   		"  }";
	   
	   
		//res = (ResponseOptions<Response>) restAssuredExtension.PostOpsWithBody(url, s);
	   
	   RequestSpecBuilder builder = new RequestSpecBuilder();
	   
	   RequestSpecification Request = RestAssured.given().spec(builder.build());
       Request.body(s);
       ResponseOptions<Response> res = Request.post("https://try.access.worldpay.com/payments/authorizations");
       
       
       Response res1 = (Response) res.getBody();
		   String s1 = commonUtility.responseToString(res1);
		
		
		
		System.out.println(res.getStatusCode());
		
		
	}

	@Then("the product is added")
	public void the_product_is_added() {
	    // Write code here that turns the phrase above into concrete actions
	    throw new cucumber.api.PendingException();
	}
	
}

